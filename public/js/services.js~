'use strict';

app.service('webAudio', ['$window', function($window){
	/*
	 *	Using the $window service, let's get a reference to
	 *	the correct 'AudioContext' (from chrome, or firefox, etc.)
	 * 
	 */

	$window.AudioContext = window.AudioContext || window.webkitAudioContext;
	this.context = new AudioContext();

	this.position = {};
	this.frequency = 1000; //freq in Hz
	var panner;
	var oscillator; 

	//source.connect(oscillator);


	this.play = function () {
		oscillator = this.context.createOscillator();
		oscillator.type = 0; //sine wave
		oscillator.frequency.value = this.frequency;
		oscillator.connect(panner);

 		panner = this.context.createPanner();
		panner.coneOuterGain = 0.1;
		panner.coneOuterAngle = 180;
		panner.coneInnerAngle = 0;
		panner.connect(this.context.destination);

		console.log("Web Audio position: " + this.position.xpos);
		var xPos = this.position.xpos;
		var yPos = this.position.ypos;
		panner.setPosition(xPos, yPos, 0.5);
		oscillator.start(0);
	};
	this.stop = function () {
		console.log("Stopping");
		oscillator.stop(0);
	};
}]);
